@page "/app/chat"
@attribute [Authorize]

<section class="chat-page">
    <header>
        <p class="eyebrow">Chat</p>
        <h1>Ask the rag-stripe Foundry agent</h1>
        <p class="lede">Grounded in uploaded pilot ops docs. If your question is off-topic, the agent will say so.</p>
    </header>

    <div class="chat-window" @ref="chatWindowRef">
        @foreach (var msg in Messages)
        {
            <article class="bubble @(msg.Sender == "user" ? "user" : "assistant")">
                <div class="meta">@msg.Sender @FormatTimestamp(msg.Timestamp)</div>
                <div class="markdown">@((MarkupString)RenderMarkdown(msg.Text))</div>
            </article>
        }

        @if (isBusy)
        {
            <div class="typing">
                <span class="dot dot-a"></span>
                <span class="dot dot-b"></span>
                <span class="dot dot-c"></span>
                <span class="typing-text">Agent is typingâ€¦</span>
            </div>
        }
    </div>

    <div class="chat-input">
        <textarea @bind="userInput" @bind:event="oninput" placeholder="Ask a question..." rows="3"></textarea>
        <div class="actions">
            <button class="btn primary" @onclick="SendAsync" disabled="@isBusy">Send</button>
            @if (!string.IsNullOrEmpty(error))
            {
                <span class="error">@error</span>
            }
        </div>
    </div>
</section>
